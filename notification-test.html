<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>WebSocket ì•Œë¦¼ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h2>âœ… WebSocket ì•Œë¦¼ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸</h2>
<p>ì•„ë˜ ë©”ì‹œì§€ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤ (ì•Œë¦¼ ì„¤ì •ì´ ONì¼ ë•Œë§Œ ìˆ˜ì‹ )</p>
<div id="log" style="border: 1px solid gray; padding: 10px; margin-top: 10px; height: 200px; overflow-y: scroll;"></div>

<script>
    const socket = new SockJS("http://localhost:8080/ws"); // ë„ˆí¬ Spring ì„œë²„ WebSocket endpoint
    const stompClient = Stomp.over(socket);

    // í…ŒìŠ¤íŠ¸í•  ì‚¬ìš©ì ID (ì„œë²„ì—ì„œ ì´ ID ê¸°ì¤€ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œë‹¤ê³  ê°€ì •)
    const userId = 2;

    stompClient.connect({}, function (frame) {
      console.log("ğŸ”Œ ì—°ê²°ë¨:", frame);

      // ê°œë³„ ì•Œë¦¼ êµ¬ë… ê²½ë¡œ (/user/queue/chat)
      stompClient.subscribe("/user/queue/chat", function (message) {
        const body = JSON.parse(message.body);
        document.getElementById("log").innerHTML += `<p>ğŸ“¨ ë©”ì‹œì§€ ë„ì°©: ${body.content}</p>`;
      });

      // ë©”ì‹œì§€ ìˆ˜ë™ ì „ì†¡ (í…ŒìŠ¤íŠ¸ìš©)
      const messageDto = {
        senderId: 1,
        chatRoomId: 5,
        content: "ğŸŒŸ ì•Œë¦¼ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤",
        messageType: "TEXT"
      };

      stompClient.send("/pub/chat.sendMessage", {}, JSON.stringify(messageDto));
    });
</script>
</body>
</html>
